<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Shadow</title>
  <!-- Stylesheets -->
  <link rel="stylesheet" href="/css/index.css">
  <link rel="stylesheet"
    href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,0,0" />
  <link rel="stylesheet" href="/css/themes.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.3.0/css/all.min.css">
  <link rel="stylesheet"
    href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&family=Open+Sans:wght@400;700&display=swap">
  <link href="https://fonts.googleapis.com/css2?family=Poppins&display=swap" rel="stylesheet">
  <link rel="icon" href="icons/logo.png" type="image/x-icon">
  <script src="/assets/settings.js"></script>
  <link rel="stylesheet"
    href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
</head>

<body>
  <!-- Loading Screen -->
  <div id="loading-screen">
    <div class="dot-container">
      <i class="loading-dots"><i class="fa-solid fa-circle"></i></i>
      <i class="loading-dots"><i class="fa-solid fa-circle"></i></i>
      <i class="loading-dots"><i class="fa-solid fa-circle"></i></i>
    </div>
    <p class="loading-text">Loading Shadow Browser</p>
  </div>

  <!-- Tabs Container -->
  <div id="tabs-container">
    <button onclick="tabs.createTab();" id="add-tab" class="control-button"
      style="font-size: 15px; height: fit-content; margin-top: 7.5px;">
      <i class="fas fa-plus"></i>
    </button>
  </div>

  <!-- Header -->
  <div id="header">
    <button id="back-button" class="control-button" style="margin-left:5px;"><span class="material-symbols-outlined">arrow_back</span></button>
    <button id="forward-button" class="control-button"><span class="material-symbols-outlined">arrow_forward</span></button>
    <button id="refresh-button" class="control-button"><span class="material-symbols-outlined">refresh</span></button>
    <form id="uv-form" class="inputcontainermain">
      <input type="text" id="search-bar" placeholder="Search or enter a URL" autocomplete="off">
      <input id="uv-search-engine" value="https://www.google.com/search?q=%s" type="hidden" />
    </form>
    <div id="menu-button" class="menu-button" style="margin-left: 15px;"><span class="material-symbols-outlined">dropdown</span></div>
  </div>

  <!-- Dropdown Menu -->
  <div id="menu-dropdown" class="dropdown-content" style="display: none">
    <table>
      <tr>
        <td id="new-tab" onclick='tabs.createTab("shadow:/\/new");'><button data-add-tab><i class="fas fa-plus"></i> New
            tab</button></td>
      </tr>
    </table>
    <table>
      <tr>
        <td><button data-add-tab onclick="bookmarksManager.newBookmark()"><i class="fas fa-plus"></i> Add
            Bookmark</button></td>
      </tr>
    </table>
    <div class="separator"></div>
    <table>
      <tr>
        <td><button data-add-tab onclick='tabs.createTab("shadow:/\/settings")'><i class="fas fa-cog"></i>
            Settings</button></td>
      </tr>
    </table>
    <table>
      <tr>
        <td><button data-add-tab onclick='tabs.createTab("shadow:/\/extensions")'><i
              class="fa-solid fa-puzzle-piece"></i> Extensions</button></td>
      </tr>
    </table>
    <table>
      <tr>
        <td><button data-add-tab onclick='tabs.createTab("shadow:/\/chat")'><i class="fa-solid fa-comments"></i>
            Chat</button></td>
      </tr>
    </table>
    <table>
      <tr>
        <td><button data-add-tab onclick='tabs.createTab("discord.gg/goshadow")'><i class="fa-brands fa-discord"></i>
            Discord</button></td>
      </tr>
    </table>
    <div class="separator"></div>
    <table>
      <tr>
        <td><button data-add-tab onclick="iframefullscreen()"><i class="fas fa-expand-arrows-alt"></i>
            Fullscreen</button></td>
      </tr>
    </table>
    <table>
      <tr>
        <td><button data-add-tab onclick="abtblank()"><i class="fas fa-sign-out-alt"></i> Open About:Blank</button></td>
      </tr>
    </table>
    <table>
      <tr>
        <td><button data-add-tab onclick="iframeabtblank()"><i class="fas fa-sign-out-alt"></i> Open Tab in
            Abt:Blank</button></td>
      </tr>
    </table>
    <table>
      <tr>
        <td><button data-add-tab onclick="exit()"><i class="fa-solid fa-circle-xmark"></i> Exit</button></td>
      </tr>
    </table>
  </div>

  <!-- Bookmarks Container -->
  <div id="bookmarks-container"></div>
  <div class="context-menu" id="bookmark-context-menu" style="display:none;">
    <div class="menu-item" onclick="editBookmark(`${title}`, `${url}`)">Edit</div>
    <div class="menu-item" onclick="deleteBookmark(`${title}`, `${url}`)">Delete</div>
  </div>
  <!-- Iframes Container -->
  <div id="iframes-container"></div>
  <div class="desc left-margin">
    <p id="uv-error"></p>
    <pre id="uv-error-code"></pre>
  </div>
  <!-- Dev extension warning -->
  <div class="extensions_disclaimer" style="display:none;" id="dev-alert">
    <div class="extensions_disclaimer_content">
      <h2 style="color: var(--accent-color)">Warning</h2>
      <p id="dev-alert-text"></p>
      <div class="buttons">
        <button class="continue-button" onclick="devWarning(true)">Continue</button>
        <button class="cancel-button" onclick="devWarning(false)">Cancel</button>
      </div>
      <label for="remember-choice">
        <input type="checkbox" id="remember-choice"> Remember Choice
      </label>
    </div>
  </div>
  <!--DEV STUFF-->
  <button class="powered-by-container" style="right:0; top:0;" onclick="reset()">Reset</button>
  <!--DEV STUFF-->
  <a id="billigerhost" class="powered-by-container" style="left:0; bottom:0;"target="_blank">
    <img src="https://billing.billigerhost.com/templates/lagom2/assets/img/favicons/favicon.ico"
      alt="ServerDeploy Logo">
    <span class="powered-by-text"><span style="color: #ad271f;">Billiger</span>Host</span>
  </a>

  <a id="discord" class="discord" target="_blank">
    <i class="fa-brands fa-discord"></i>
  </a>
  <!-- Scripts -->
  <script src="/epoxy/index.js"></script>
  <script src="/assets/search.js"></script>
  <script src="/assets/themes.js"></script>
  <script src="/assets/options.js"></script>
  <script src="/assets/search.js"></script>
  <script src="/uv/uv.bundle.js"></script>
  <script src="/uv/uv.config.js"></script>
  <script src="/uv/uv.sw.js"></script>
  <script src="/uv/uv.config.js"></script>
  <script src="/assets/tabs.js" async></script>
  <script src="/assets/bookmarks.js" async></script>
  <script>
    if ("serviceWorker" in navigator) {
      window.addEventListener("load", () => {
        navigator.serviceWorker.register("/sw.js", {
          scope: "/"
        });
      });
    }
  </script>
  <script>
  if(!localStorage.getItem("searchEngine")) localStorage.setItem("searchEngine", "https://www.google.com/search?q=%s");

  document.getElementById("uv-search-engine").value = localStorage.getItem("searchEngine");


    function updtSearchEngine(value) {
      document.getElementById("uv-search-engine").value = value;
    }

    window.addEventListener("storage", function (event) {
      if (event.key === "searchEngineValue") {
        updtSearchEngine(event.newValue);
      }
    });

    function reset() {
      localStorage.clear();
      navigator.serviceWorker.getRegistrations().then(registrations => {
        for (const registration of registrations) {
          registration.unregister();
        } 
      });
      location.reload();
    }

    function updateOmni() {
      tabs.updateOmni();
    }

    function setTab() {
      tabs.setTab();
    }

    function createTab(i) {
      tabs.createTab(i);
    }

    function load(i) {
      tabs.load(i);
    }

    function devAlert(i) {
      let message = `You have some extensions that are NOT from the store:\n`
      i.forEach(a => {
        message += `${a}\n`
      });
      message += "These could potentially be dangerous. Would you like to continue?"
      document.getElementById("dev-alert-text").innerText = message;
      document.getElementById("dev-alert").style.display = "block";
    }

    function devWarning(i) {
      if (i) {
        document.querySelector("iframe.active").contentWindow.devContinue();
      }
      document.getElementById("dev-alert").style.display = "none";
    }

    function updateMenu(i) {
      const menu = document.getElementById("menu-dropdown");
      const item = menu.children[0];
      console.log(item)
      const newElem = item.cloneNode();
      console.log(newElem)
      const a = newElem.children
      console.log(a)
      a.innerHTML = `button data-add-tab onclick=\"${i.onclick}\"><i class=\"${i.iconClass}\"></i> ${i.label}</button>`;
      menu.appendChild(newElem);
    }
    const obj = {
      "onclick": "",
      "iconClass": "",
      "label": ""
    }
    updateMenu(obj)

    const ua = navigator.userAgent

    if (ua.includes("OPR") || ua.includes("Firefox")) {
      //Some features are unsupported (For example omnibox auto update omnibox)
      if (confirm("You are using an unsupported browser. \nSome features may not work, would you like to enable the experimental support features?")) {
        showExpirmentalFeatures();
        if (confirm("Would you like to remember this choice? You can always change this in settings.")) {
          localStorage.setItem("expirementalSupport", true)
        }
      } else {
        console.log("User doesn't want experimental support features")
      }
    } else {
      console.log("Using supported browser, continue")
    }
  </script>
  <script>
    window.addEventListener('load', function () { const loadingScreen = document.getElementById('loading-screen'); loadingScreen.style.display = 'none'; });
    document.getElementById("search-bar").addEventListener("focus", (e) => {
      e.target.select();
    })
    onload = () => {
      parent.updateOmni();
      parent.setTab();
    }

    document.getElementById("billigerhost").onclick = (e) => {
      if (e.shiftKey) {
        parent.createTab("https://billing.billigerhost.com");
        setTimeout(updateOmni, 2500);
      } else {
        window.open("https://billing.billigerhost.com", "_blank");
      }
    }
  </script>
</body>

</html>