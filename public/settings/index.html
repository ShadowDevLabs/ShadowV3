<!doctype html>
<html lang="en">

<head>
  <script src="/assets/themes.js" type="module"></script>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css"
    integrity="sha512-Kc323vGBEqzTmouAECnVceyQqyqdsSiqLQISBL29aUW4U/M7pSPA/gEUZQqv1cwx4OnYxTxve5UMg5GT6L4JJg=="
    crossorigin="anonymous" referrerpolicy="no-referrer" />
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" />
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;700&display=swap" />
  <link href="https://fonts.googleapis.com/css2?family=Rubik&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="/css/settings.css" />
  <link rel="stylesheet" href="/css/themes.css" />
  <title>Settings</title>
  <link rel="icon" href="/icons/logo.png" type="image/x-icon" />
  <script src="/assets/settings.js" type="module"></script>
  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-NCTSG4T1B6"></script>
  <script>window.dataLayer = window.dataLayer || []; function gtag() { dataLayer.push(arguments); } gtag('js', new Date()); gtag('config', 'G-NCTSG4T1B6');</script>
</head>

<body onload="try {showContent('general'); parent.updateOmni(); parent.setTab();} catch(_){}">
  <div id="sidebar">
    <div class="menu-item" onclick="showContent('general')">
      <i class="fas fa-cog menu-icon"></i>
      <span class="menu-label">General</span>
    </div>
    <div class="menu-item" onclick="showContent('themes')">
      <i class="fa-solid fa-paintbrush menu-icon"></i>
      <span class="menu-label">Themes</span>
    </div>
    <div class="menu-item" onclick="showContent('search')">
      <i class="fas fa-search menu-icon"></i>
      <span class="menu-label">Search</span>
    </div>
    <div class="menu-item" onclick="showContent('developer')">
      <i class="fas fa-code menu-icon"></i>
      <span class="menu-label">Developer</span>
    </div>
  </div>
  <div id="content">
    <div id="general-content">
      <div class="content-title">General</div>
      <!-- Tabs Cloak -->
      <div class="settings-section">
        <h2 class="section-title">Tab Cloak</h2>
        <div class="section-content">
          <div class="buttons">
            <input id="title" class="input-field" placeholder="Title" onkeyup="setTitle(this.value)" />
            <input id="icon" class="input-field" placeholder="Favicon" onkeyup="setFavicon(this.value.trim())" />
          </div>
          <p class="section-content">Ready Made Cloaks</p>
          <div class="buttons">
            <select name="Readymade Cloaks" id="premadecloaks" class="input-field" title="Cloaks">
              <option value="search">Google Search</option>
              <option value="drive">Google Drive</option>
              <option value="youtube">YouTube</option>
              <option value="gmail">Gmail</option>
              <option value="calendar">Google Calendar</option>
              <option value="meets">Google Meet</option>
              <option value="classroom">Google Classroom</option>
              <option value="canvas">Canvas</option>
              <option value="zoom">Zoom</option>
              <option value="khan">Khan Academy</option>
            </select>
            <div class="select-buttons">
              <button class="icon-button" onclick="setCloak()">
                <i class="fas fa-cogs"></i> Set
              </button>
              <button class="icon-button" onclick="resetTab()">
                <i class="fas fa-undo-alt"></i> Reset
              </button>
            </div>
          </div>
        </div>
      </div>

      <br /><br />
      <!-- About:blank -->
      <div class="settings-section">
        <h2 class="section-title">About:Blank</h2>
        <div class="section-content">
          <p class="section-text">
            The button below opens the site as an about:blank, hiding it from
            your history.
          </p>
          <button class="icon-button" onclick="aboutBlank()">
            <i class="fas fa-rocket"></i> Launch
          </button>
        </div>
      </div>
      <br /><br />
      <div class="settings-section">
        <h2 class="section-title">Auto Blank</h2>
        <div class="section-content">
          <p class="section-text">
            Enable automatic about:blank cloaking. This can help prevent the site from showing up in your search
            history, and hides the site from some blockers.
          </p>
          <div class="switch">
            <input type="checkbox" class="switch" id="autoBlankSwitch" onclick="setAutoBlank();" />
            <label for="autoBlankSwitch" class="slider"></label>
          </div>
        </div>
      </div>
      <br />
      <!--Toggle auto save/load tabs-->
      <div class="settings-section">
        <h2 class="section-title">Auto Save/Load Tabs</h2>
        <div class="section-content">
          <p class="section-text">
            Automatically reload tabs from older sessions, toggle auto saving
            and loading here.
          </p>
          <div class="switch">
            <input type="checkbox" class="switch" id="saveTabsSwitch" onclick="setSaveTabs();" />
            <label for="saveTabsSwitch" class="slider"></label>
          </div>
        </div>
      </div>
      <br />
      <div class="settings-section">
        <h2 class="section-title">History</h2>
        <div class="section-content">
          <p class="section-text">
            Save your history! History is accessibly at <span style="cursor: pointer; color: var(--accent-color);" onclick="top.tabs.createTab('shadow:/\/history')">shadow://history</span>
          </p>
          <div class="switch">
            <input type="checkbox" class="switch" id="historySwitch" onclick="toggleHistory();" />
            <label for="historySwitch" class="slider"></label>
          </div>
        </div>
      </div>
      <br />
      <!-- Close Protection -->
      <div class="settings-section">
        <h2 class="section-title">Close Protection</h2>
        <div class="section-content">
          <p class="section-text">
            Prevent extensions and teachers from closing tabs! Will present a confirmation popup whenever an attempt to
            close the page occurs.
          </p>
          <div class="switch">
            <input type="checkbox" class="switch" id="closeProtSwitch" onclick="toggleCloseProt()" />
            <label for="closeProtSwitch" class="slider"></label>
          </div>
        </div>
      </div>
    </div>

    <!-- Themes -->
    <div id="themes-content">
      <div class="content-title">Themes</div>

      <!-- Premade -->
      <div class="settings-section">
        <h2 class="section-title">Pre-Made Themes</h2>
        <div class="section-content">
          <p class="section-text">
            Choose between the following themes. This will change the
            appearance of the site.
          </p>
          <div class="themes-container" id="themes-container">
            <!-- Theme Buttons Get Loaded here-->
          </div>
        </div>
      </div>

      <!-- Custom -->
      <div class="settings-section">
        <h2 class="section-title">Custom Themes</h2>
        <div class="section-content">
          <p class="section-text">
            Create your own theme with the custom theme maker! Enter a base color, and we'll generate a theme for you!
          </p>
          <input type="color" id="themeColorPicker" name="themeColorPicker" value="#"> <br><br>
          <button class="icon-button" onclick="applyCustomTheme()">
            <i class="fa-brands fa-codepen fa-lg"></i> Apply Theme
          </button>
        </div>
      </div>

    </div>

    <div id="search-content">
      <div class="content-title">Search</div>
      <!-- Engine -->
      <div class="settings-section">
        <h2 class="section-title">Search Engine</h2>
        <div class="section-content">
          <p class="section-text">
            Changing this will change the search engine used when searching.
          </p>
          <select id="searchEngineDropdown" class="input-field">
            <option value="google" data-url="https://www.google.com/search?q=%s">
              Google
            </option>
            <option value="bing" data-url="https://www.bing.com/search?q=%s">
              Bing
            </option>
            <option value="yahoo" data-url="https://search.yahoo.com/search?p=%s">
              Yahoo
            </option>
            <option value="duckduckgo" data-url="https://duckduckgo.com/?q=%s">
              DuckDuckGo
            </option>
            <option value="brave" data-url="https://search.brave.com/search?q=%s">
              Brave
            </option>
            <option value="yandex" data-url="https://yandex.com/search/?text=%s">
              Yandex
            </option>
          </select>
        </div>
      </div>
      <br /><br />
      <!-- Proxy -->
      <!-- <div class="settings-section">
        <h2 class="section-title">Proxy</h2>
        <div class="section-content">
          <p class="section-text">
            This is the proxy that is used when searching.
          </p>  
          <select id="proxyDropdown" class="input-field">
            <option value="ultraviolet">Ultraviolet</option>
            <option value="dynamic">Dynamic</option>
          </select>
        </div>
      </div> -->
    </div>


    <div id="developer-content">
      <div class="content-title">Developer Tools</div>

      <div class="settings-section">
        <h2 class="section-title">Change Transport</h2>
        <div class="section-content">
          <p class="section-text">Change the transport and Wisp Server URL that's used when searching on Shadow.
          </p>
          <select id="wispSelection" onchange="wispURLOption()" class="input-field">
            <option value="default">Default Server</option>
            <option value="custom">Custom Server</option>
          </select>

          <select id="transportSelection" onchange="changeTransport()" class="input-field">
            <option value="/epoxy/index.mjs">Epoxy</option>
            <option value="/libcurl/index.mjs">Libcurl</option>
          </select>
          <br>

          <input value="phantom.lol" style="width:90%; display:none; margin-top: 2.5vh;" class="input-field"
            id="wispURL" /> <br>

          <div class="flex-div" style="display:none;" id="wispBtn">
            <button class="icon-button" onclick="window.setUrl(); ShowNotification('Wisp URL changed.', 'wispnoti')">
              <i class="fa-solid fa-link"></i> Set Wisp URL
            </button>
            <p class="notification" id="wispnoti"></p>
          </div>
        </div>
      </div>

      <!-- User Agent -->
      <div class="settings-section">
        <h2 class="section-title">Custom User Agent</h2>
        <div class="section-content">
          <p class="section-text">Switch between different user agents. Some agents may cause issues.</p>
          <input placeholder="" style="width:90%;" class="input-field" id="customUserAgent" /> <br><br>
          <button class="icon-button" id="ua"
            onclick="customUA = document.getElementById('customUserAgent').value; setUA(customUA);">Choose
            Agent</button>
        </div>
      </div> <br>

      <!-- Dump Dev Tools - -->
      <div class="settings-section">
        <h2 class="section-title">Dump Error Logs</h2>
        <div class="section-content">
          <p class="section-text">Access all the errror logs. (Debugging Tool)</p>
          <button class="icon-button" onclick="navigator.clipboard.writeText(parent.dewasper.dump());"><i
              class="fa-solid fa-download"></i> Dump</button>
        </div>

      </div>
    </div>
    <script type="module">
      import { SettingsManager } from "/assets/settings_manager.js"
      import { checkWispUrl } from "/assets/wispchecker.js"
      import { changeTheme as _changeTheme, applyCustomTheme as _applyCustomTheme } from "/assets/themes.js"
      import { HistoryHelper } from "/assets/history_helper.js"

      window.changeTheme = _changeTheme;
      window.applyCustomTheme = _applyCustomTheme;
      window.settings = new SettingsManager();
      window.historyHelper = new HistoryHelper();
      document.getElementById("autoBlankSwitch").checked = await window.settings.get('auto-blank');
      document.getElementById("historySwitch").checked = await window.settings.get('history');
      document.getElementById("saveTabsSwitch").checked = await window.settings.get("save-tabs");
      document.getElementById("closeProtSwitch").checked = await window.settings.get('close-protection');
      document.getElementById("transportSelection").value = await window.settings.get('transport');
      document.getElementById("customUserAgent").value = await window.settings.get('user-agent') || navigator.userAgent;

      const urlToValueMap = {
        "https://www.google.com/search?q=%s": "google",
        "https://www.bing.com/search?q=%s": "bing",
        "https://search.yahoo.com/search?p=%s": "yahoo",
        "https://duckduckgo.com/?q=%s": "duckduckgo",
        "https://search.brave.com/search?q=%s": "brave",
        "https://yandex.com/search/?text=%s": "yandex"
      };
      document.getElementById("searchEngineDropdown").value = urlToValueMap[await window.settings.get('search-engine')];

      if (!(await window.settings.get("server")).startsWith(`wss://${location.host}`)) {
        document.getElementById("wispSelection").value = 'custom';
        wispURLOption();
      }

      window.setUA = async function (agent) {
        agent = agent || navigator.userAgent;
        await window.settings.set("user-agent", agent);
        navigator.serviceWorker.register("/sw.js", {
          scope: "/"
        });
        document.getElementById("customUserAgent").value = await window.settings.get("user-agent");
      }

      window.setUrl = async function (url = document.getElementById('wispURL').value) {
        const wsUrl = await checkWispUrl(url);
        await window.settings.set("server", wsUrl);
        parent.tabs.setTransport();
      }
    </script>

    <script defer>
      async function toggleCloseProt() {
        await window.settings.toggle("close-protection");
        if (!await window.settings.get("close-protection")) {
          top.onbeforeunload = null;
          console.log("Disabling close setting");
        } else {
          top.onbeforeunload = function (e) { e.preventDefault(); return true; /* Prevent automatic tab closing */ };
          console.log("Enabling close setting");
        }
      }

      async function setHistory() {
        await window.settings.toggle("history")
      }

      async function setAutoBlank() {
        await window.settings.toggle("auto-blank");
      }

      async function setSaveTabs() {
        await window.settings.toggle("save-tabs")
        if (!await window.settings.get("save-tabs")) {
          await window.historyHelper.clear("open-tabs");
        }
      }

      function aboutBlank() {
        if (parent !== window) {
          parent.abtblank();
        } else {
          abtblank();
        }
      }

      async function changeTransport(transport = document.getElementById("transportSelection").value) {
        await window.settings.set("transport", transport);
        window.setUrl();
        parent.tabs.setTransport();
      }

      function showContent(contentId) {
        const contentSections = document.querySelectorAll("#content > div");
        contentSections.forEach((section) => {
          section.style.display = "none";
        });

        const selectedSection = document.getElementById(contentId + "-content");
        if (selectedSection) {
          selectedSection.style.display = "block";
        }
      }

      async function updateEngine() {
        var dropdown = document.getElementById("searchEngineDropdown");
        var selectedOption = dropdown.options[dropdown.selectedIndex];
        var dataUrl = selectedOption.getAttribute("data-url");
        await window.settings.set("search-engine", dataUrl);
        if (parent) parent.tabs.updateSearchEngine();
      }

      var searchEngineDropdown = document.getElementById(
        "searchEngineDropdown",
      );

      searchEngineDropdown.addEventListener("change", updateEngine);
    </script>
    <script src="/assets/options.js"></script>
    <script src="/assets/notifications.js"></script>
    <script src="script.js"></script>
</body>

</html>